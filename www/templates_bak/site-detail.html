<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>站点详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!--标准mui.css-->
    <link rel="stylesheet" href="../components/mui/css/mui.min.css">
    <!--App自定义的css-->
    <!--<link rel="stylesheet" type="text/css" href="./css/app.css" />-->
    <!--<link href="./css/mui.indexedlist.css" rel="stylesheet" />-->
    <link rel="stylesheet" href="../css/my.css" />
    <!--<link rel="stylesheet" type="text/css" href="./css/mui.indexedlist.css">-->
    <style>

        html,
        body {
            height: 100%;
            overflow: hidden;
        }
        .mui-bar {
            -webkit-box-shadow: none;
            box-shadow: none;
        }
        .mui-table-cell h4{
            font-size: 16px;
            line-height: 18px;
            font-weight: normal;
            color: #1f1f1f;
        }
        .mui-media-body>span:first-child{
            color: #1f1f1f;
        }
        .mui-bar .mui-icon {
            top: 6px;
        }
        .mui-table-view .mui-media-object.status{
            width: 20px;
            height: 20px;
            margin-top: 8px;
            border-radius: 50%;
        }
        .mui-content{
            padding: 0;
        }
        .mui-card{
            margin: 0;
            border-radius:0;
            margin-bottom: 8px;
            box-shadow: none;
        }
        .mui-card-header{
            color: #949494;
            margin-top: 4px;
        }
        .mui-card-header:after{
            display: none;
        }
    </style>
    <script type="text/javascript" src="../components/libs/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="../components/angular/angular.min.js"></script>
    <script type="text/javascript" src="../js/app/app.js"></script>
    <script type="text/javascript" src="../js/controller/sites.js"></script>
</head>

<body class="mui-android mui-android-5 mui-android-5-1 mui-android-5-1-1" ng-app="myApp">
<header class="mui-bar mui-bar-transparent">
    <a class="mui-icon mui-action-back mui-icon-left-nav mui-pull-left text-white"></a>
    <h1 class="mui-title" id="header_title"></h1>
</header>
<div style="padding: 10px 0px;position: fixed;top: 44px;left: 0;">
    <div id="menu" class="mui-segmented-control" style="width: 100%;margin-left: 0;border-radius: 0;">
        <a class="mui-control-item mui-active" href="#baseInfo">概览</a>
        <a class="mui-control-item" href="#realtime">实时</a>
        <a class="mui-control-item" href="#monitor">监控画面</a>
    </div>
</div>
<div class="mui-content" ng-controller="SiteDetailCtrl" ng-cloak>
    <div id="baseInfo" class="mui-control-content height-wrap-parent mui-active" ng-controller="SiteBaseInfoCtrl">
        <div ng-show="!baseLoading">
            <div style="width: 100%;height: 250px;">
                <div id="map" style="width: 100%;height: 100%;"></div>
            </div>
            <ul class="mui-table-view mui-grid-view mui-grid-9" style="background-color: #fff;">
                <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
                    <a href="device-list.html?sn={{sn}}">
                        <span class="mui-icon icon icon-ms icon-devices"></span>
                        <div class="mui-media-body">设备</div>
                    </a>
                </li>
                <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
                    <a href="event-list.html?sn={{sn}}">
                        <span class="mui-icon icon icon-ms icon-events"></span>
                        <div class="mui-media-body">事件</div>
                    </a>
                </li>
                <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
                    <a href="electric-docs.html?sn={{sn}}">
                        <span class="mui-icon icon icon-ms icon-docs"></span>
                        <div class="mui-media-body">电子档案</div>
                    </a>
                </li>
            </ul>
            <ul class="mui-table-view mui-table-view-chevron">
                <li class="mui-table-view-cell">
                    <label class="text-title">站点地址</label>
                    <label class="text-value mui-pull-right">{{siteData.address}}</label>
                </li>
                <li class="mui-table-view-cell">
                    <label class="text-title">额定负载</label>
                    <label class="text-value mui-pull-right">{{siteData.capacity}}KW</label>
                </li>
                <li class="mui-table-view-cell">
                    <label class="text-title">供电类型</label>
                    <label class="text-value mui-pull-right">{{siteData.power_supply_type}}</label>
                </li>
                <li class="mui-table-view-cell">
                    <label class="text-title">电压等级</label>
                    <label class="text-value mui-pull-right">{{siteData.voltage_class}}</label>
                </li>
            </ul>
        </div>
    </div>
    <div id="realtime" class="mui-control-content height-wrap-parent" ng-controller="SiteRealTimeCtrl">
        <div ng-show="!isLoading">
            <div class="mui-card" ng-if="varGroups.keyVarGroupName.data.length">
                <div class="mui-card-content">
                    <ul class="mui-row summary-list" style="padding: 8px 0;">
                        <li ng-repeat="v in varGroups.keyVarGroupName.data" class="mui-col-xs-6 mui-col-sm-6 summary-item">
                            <span class="title">{{v.name}}</span>
                            <h4 class="value">{{v.data}}<span class="unit">{{v.unit}}</span></h4>
                    </ul>
                </div>
            </div>
            <div class="mui-card" id="chartCard">
                <div class="mui-slider" id="chartSlider" style="padding-bottom: 20px;">
                    <div class="mui-slider-group" id="chartGroup">
                        <div class="mui-slider-item">
                        </div>
                    </div>
                </div>
                <ul class="slidesjs-pagination" style="bottom: -8px;" id="chartSlidesPagination">
                </ul>
            </div>
            <div class="mui-card mui-segmented-control-vertical" id="eventSummary" style="display: none;" ng-controller="EventListCtrl">
                <div class="mui-card-header">事件与告警<a href="event-list.html?sn={{sn}}">更多</a></div>
                <div class="mui-card-content">
                    <div class="mui-card-content-inner" style="padding: 0 15px;">
                        <ul class="mui-table-view">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-alert-wrapper" ng-if="isLoading">
            <div class="page-alert">
                <span class="mui-spinner"></span>
                <div class="alert-text info">正在加载...</div>
            </div>
        </div>
        <div class="page-alert-wrapper" ng-if="!hasData && !isLoading">
            <div class="page-alert">
                <div class="page-alert">
                    <i class="alert-icon nodata"></i>
                    <div class="alert-text info">站点无数据</div>
                </div>
            </div>
        </div>
    </div>
    <div id="monitor" class="mui-control-content height-wrap-parent" ng-controller="MonitorListCtrl">
        <ul class="mui-table-view mui-grid-view mui-grid-9" style="background-color: #fff;">
            <li class="mui-table-view-cell mui-media mui-col-xs-6 mui-col-sm-6" ng-repeat="screen in monitorScreens" style="border-bottom: 0;">
                <a href="monitor-detail.html?screen=h&url={{screen.mobile_screen_link}}">
                <span class="mui-icon"><img src="{{screen.icon_link}}" style="width: 80px;height: 65px;"></span>
                <div class="mui-media-body" style="color: #333;">{{screen.name}}</div></a>
            </li>
        </ul>
        <div class="page-alert-wrapper" ng-if="monitorLoading">
            <div class="page-alert">
                <span class="mui-spinner"></span>
                <div class="alert-text info">正在加载...</div>
            </div>
        </div>
        <div class="page-alert-wrapper" ng-if="!monitorScreens.length && !monitorLoading">
            <div class="page-alert">
                <i class="alert-icon nodata"></i>
                <div class="alert-text info">暂无监控页面</div>
            </div>
        </div>
    </div>
</div>
<script>
    function setTitle() {
        $("#header_title").html(GetQueryString('site'));
    }
    setTitle();
    $(function () {
        loadEvents();
    });
    function loadEvents() {     //获取事件数据
        $('div[ng-controller="EventListCtrl"]').scope().getDataList(function (data) {
            // 将最近的三个事件显示在首页
            if (!data || !data.length){
                return;
            }
            var eventLines = '', item;
            for (var i in data){
                if (i>=3){
                    break;
                }
                item = data[i];
                eventLines += '<li class="mui-table-view-cell">' + item.update_time + '&nbsp;&nbsp;&nbsp;' + item.info + '</li>';
            }
            $("#eventSummary").show().find('ul').html(eventLines);
        });
        $('a[href="#item3"]').data('inited', true);
    }

    var chartTitle = $("#chartTitle"), leftArrow=chartTitle.prev(), rightArrow=chartTitle.next();
    document.querySelector('#chartSlider').addEventListener('slide', function(event) {
        var sliderNumber = event.detail.slideNumber;
        $("#chartSlidesPagination li a").removeClass('active');
        $("#chartSlidesPagination li:eq(" + (sliderNumber-1) + ") a").addClass('active');
    });
    function initNavMenu() {
        var $items = $("#menu .mui-control-item");
        $items.data('inited', false).on('click', function () {
            console.log('menu click');
        }).on('tap', function () {
            if (!$(this).data('inited')){
                var id=this.attributes.href.nodeValue;
                angular.element(id).scope().getDataList();
                $(this).data('inited', true);
            }
            console.log('menu tap');
        }).first().data('inited', true);
    }
    initNavMenu();
</script>
<script src="../components/mui/js/mui.min.js"></script>
<script src="../components/libs/echarts-all.js"></script>
<script src="../components/fastclick-master/lib/fastclick.js"></script>
<script src="../js/my/notify.js"></script>
<script src="../components/dropload-gh-pages/dist/dropload.min.js"></script>
<script type="text/javascript" src="../components/baidu/map/map.min.js"></script>
<script type="text/javascript" src="../components/baidu/map/MarkerManager-1.2.min.js"></script>
</body>

</html>